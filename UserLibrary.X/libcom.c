/*******************************************************************************
 *
 * MODULE :Library common definition source file
 *
 * CREATED:2019/03/17 03:27:00
 * AUTHOR :Nakanohito
 *
 * DESCRIPTION:Microchip PIC Library Common definition 
 *
 * CHANGE HISTORY:
 *
 * LAST MODIFIED BY:
 *
 *******************************************************************************
 * Copyright (c) 2019, Nakanohito
 * This software is released under the MIT License, see LICENSE.txt.
 * https://opensource.org/licenses/MIT
 ******************************************************************************/

/******************************************************************************/
/***       Include files                                                    ***/
/******************************************************************************/
#include <xc.h>
#include "libcom.h"           // 共通定義

/******************************************************************************/
/***       Macro Definitions                                                ***/
/******************************************************************************/

/******************************************************************************/
/***        Type Definitions                                                ***/
/******************************************************************************/

/******************************************************************************/
/***        Local Function Prototypes                                       ***/
/******************************************************************************/

/******************************************************************************/
/***        Exported Variables                                              ***/
/******************************************************************************/

/******************************************************************************/
/***        Local Variables                                                 ***/
/******************************************************************************/
/** クリティカルセクションの階層カウンタ */
static volatile uint8 u8Depth = 0;

/******************************************************************************/
/***        Exported Functions                                              ***/
/******************************************************************************/

/*******************************************************************************
 *
 * NAME: criticalSec_vBegin
 *
 * DESCRIPTION:クリティカルセクションの開始
 *
 * PARAMETERS:  Name            RW  Usage
 *
 * RETURNS:
 *
 * NOTES:
 * None.
 ******************************************************************************/
extern void criticalSec_vBegin() {
    GIE = 0;
    u8Depth++;
}

/*******************************************************************************
 *
 * NAME: criticalSec_vEnd
 *
 * DESCRIPTION:クリティカルセクションの終了
 *
 * PARAMETERS:  Name            RW  Usage
 *
 * RETURNS:
 *
 * NOTES:
 * None.
 ******************************************************************************/
extern void criticalSec_vEnd() {
    u8Depth--;
    if (u8Depth == 0) {
        GIE = 1;
    }
}

/******************************************************************************/
/***        Local Functions                                                 ***/
/******************************************************************************/

/******************************************************************************/
/***        END OF FILE                                                     ***/
/******************************************************************************/
